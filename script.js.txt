let allSurahs = [], currentSurahId = 1;
let isMuted = localStorage.getItem('isMuted') === 'true';
const audio = document.getElementById('audioPlayer');
const playBtn = document.getElementById('playBtn');
const seekSlider = document.getElementById('seekSlider');
const notifySound = document.getElementById('notificationSound');

// --- 1. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
function toggleMenu() { document.getElementById('sideMenu').classList.toggle('open'); }
function toggleMute() { 
    isMuted = !isMuted; 
    localStorage.setItem('isMuted', isMuted); 
    document.getElementById('muteBtn').innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š"; 
}
function playNotify() { 
    if (!isMuted) { 
        notifySound.currentTime = 0; 
        notifySound.play().catch(e => console.log("Audio play failed")); 
    } 
}

// --- 2. Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… ---
fetch('https://api.alquran.cloud/v1/surah').then(res => res.json()).then(data => { 
    allSurahs = data.data; 
    displaySurahs(allSurahs); 
});

function displaySurahs(surahs) { 
    const list = document.getElementById('surahList');
    list.innerHTML = surahs.map(s => `<div class="surah-card" onclick="openSurah(${s.number}, '${s.name}')">${s.number}. ${s.name}</div>`).join(''); 
}

function filterSurahs() { 
    const term = document.getElementById('searchInput').value; 
    displaySurahs(allSurahs.filter(s => s.name.includes(term))); 
}

function openSurah(id, name) {
    currentSurahId = id;
    document.getElementById('sideMenu').classList.remove('open');
    document.getElementById('main-view').style.display = 'none';
    document.getElementById('quran-view').style.display = 'block';
    document.getElementById('current-surah-title').innerText = name;
    updateAudioSource();
    fetch(`https://api.alquran.cloud/v1/surah/${id}`).then(res => res.json()).then(data => {
        document.getElementById('ayahsContainer').innerHTML = data.data.ayahs.map(a => `${a.text} <span style="color:var(--gold); font-size: 1.1rem;">(${a.numberInSurah})</span>`).join(' ');
    });
}

function showMain() { 
    document.getElementById('main-view').style.display = 'block'; 
    document.getElementById('quran-view').style.display = 'none'; 
    audio.pause(); 
    if(playBtn) playBtn.innerText = "â–·";
}

function updateAudioSource() {
    const r = document.getElementById('reciterSelect').value;
    const srv = { 'afs': '8', 'minsh': '10', 'basit': '7', 'husr': '13', 'maher': '12', 'qtm': '11', 'yasser': '11' };
    audio.src = `https://server${srv[r]}.mp3quran.net/${r}/${currentSurahId.toString().padStart(3, '0')}.mp3`;
    if (!audio.paused) audio.play();
}

function toggleAudio() { 
    if (audio.paused) { audio.play(); playBtn.innerText = "||"; } 
    else { audio.pause(); playBtn.innerText = "â–·"; } 
}

audio.ontimeupdate = () => { 
    if (audio.duration) { 
        seekSlider.value = (audio.currentTime / audio.duration) * 100; 
        document.getElementById('currentTime').innerText = formatTime(audio.currentTime); 
        document.getElementById('durationTime').innerText = formatTime(audio.duration); 
    } 
};

function seekAudio() { audio.currentTime = (seekSlider.value / 100) * audio.duration; }
function formatTime(s) { const m = Math.floor(s/60); const sc = Math.floor(s%60); return `${m}:${sc<10?'0'+sc:sc}`; }

// --- 3. Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£Ø¯Ø¹ÙŠØ© (Ù…ÙˆØ³Ø¹Ø© ÙˆÙ…ÙØµÙ„Ø©) ---
const azkarData = {
    morning: [
        { id: "m1", text: "Ø£Ø¹ÙˆØ° Ø¨Ø§Ù„Ù„Ù‡ Ù…Ù† Ø§Ù„Ø´ÙŠØ·Ø§Ù† Ø§Ù„Ø±Ø¬ÙŠÙ…: {Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙ‘Ù Ø§Ù„Ù’Ù‚ÙÙŠÙ‘ÙÙˆÙ…Ù Ù„ÙØ§ ØªÙØ£Ù’Ø®ÙØ°ÙÙ‡Ù Ø³ÙÙ†ÙØ©ÙŒ ÙˆÙÙ„ÙØ§ Ù†ÙÙˆÙ’Ù…ÙŒ Ù„ÙÙ‡Ù Ù…ÙØ§ ÙÙÙŠ Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙÙ…ÙØ§ ÙÙÙŠ Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù Ù…ÙÙ†Ù’ Ø°ÙØ§ Ø§Ù„Ù‘ÙØ°ÙÙŠ ÙŠÙØ´Ù’ÙÙØ¹Ù Ø¹ÙÙ†Ù’Ø¯ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø¨ÙØ¥ÙØ°Ù’Ù†ÙÙ‡Ù ÙŠÙØ¹Ù’Ù„ÙÙ…Ù Ù…ÙØ§ Ø¨ÙÙŠÙ’Ù†Ù Ø£ÙÙŠÙ’Ø¯ÙÙŠÙ‡ÙÙ…Ù’ ÙˆÙÙ…ÙØ§ Ø®ÙÙ„Ù’ÙÙÙ‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ ÙŠÙØ­ÙŠØ·ÙÙˆÙ†Ù Ø¨ÙØ´ÙÙŠÙ’Ø¡Ù Ù…ÙÙ†Ù’ Ø¹Ù„ÙŠÙ…ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø¨ÙÙ…ÙØ§ Ø´ÙØ§Ø¡Ù ÙˆÙØ³ÙØ¹Ù ÙƒÙØ±Ù’Ø³ÙÙŠÙ‘ÙÙ‡Ù Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§ÙˆÙØ§ØªÙ ÙˆÙØ§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù ÙˆÙÙ„ÙØ§ ÙŠÙØ¦ÙÙˆØ¯ÙÙ‡Ù Ø­ÙÙÙ’Ø¸ÙÙ‡ÙÙ…ÙØ§ ÙˆÙÙ‡ÙÙˆÙ Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ‘Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù}", count: 1 },
        { id: "m2", text: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù: {Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø£ÙØ­ÙØ¯ÙŒ * Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø§Ù„ØµÙ‘ÙÙ…ÙØ¯Ù * Ù„ÙÙ…Ù’ ÙŠÙÙ„ÙØ¯Ù’ ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙˆÙ„ÙØ¯Ù’ * ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙƒÙÙ†Ù’ Ù„ÙÙ‡Ù ÙƒÙÙÙÙˆÙ‹Ø§ Ø£ÙØ­ÙØ¯ÙŒ}", count: 3 },
        { id: "m3", text: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù: {Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨Ù‘Ù Ø§Ù„Ù’ÙÙÙ„ÙÙ‚Ù * Ù…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù Ù…ÙØ§ Ø®ÙÙ„ÙÙ‚Ù * ÙˆÙÙ…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù ØºÙØ§Ø³ÙÙ‚Ù Ø¥ÙØ°ÙØ§ ÙˆÙÙ‚ÙØ¨Ù * ÙˆÙÙ…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù Ø§Ù„Ù†Ù‘ÙÙÙ‘ÙØ§Ø«ÙØ§ØªÙ ÙÙÙŠ Ø§Ù„Ù’Ø¹ÙÙ‚ÙØ¯Ù * ÙˆÙÙ…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù Ø­ÙØ§Ø³ÙØ¯Ù Ø¥ÙØ°ÙØ§ Ø­ÙØ³ÙØ¯Ù}", count: 3 },
        { id: "m4", text: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±Ù‘ÙØ­ÙÙŠÙ…Ù: {Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨Ù‘Ù Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù * Ù…ÙÙ„ÙÙƒÙ Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù * Ø¥ÙÙ„ÙÙ‡Ù Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù * Ù…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù Ø§Ù„Ù’ÙˆÙØ³Ù’ÙˆÙØ§Ø³Ù Ø§Ù„Ù’Ø®ÙÙ†Ù‘ÙØ§Ø³Ù * Ø§Ù„Ù‘ÙØ°ÙÙŠ ÙŠÙÙˆÙØ³Ù’ÙˆÙØ³Ù ÙÙÙŠ ØµÙØ¯ÙÙˆØ±Ù Ø§Ù„Ù†Ù‘ÙØ§Ø³Ù * Ù…ÙÙ†Ù Ø§Ù„Ù’Ø¬ÙÙ†Ù‘ÙØ©Ù ÙˆÙØ§Ù„Ù†Ù‘ÙØ§Ø³Ù}", count: 3 },
        { id: "m5", text: "Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ ÙˆÙØ£ÙØµÙ’Ø¨ÙØ­Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ.", count: 1 },
        { id: "m5_2", text: "Ø±ÙØ¨Ù‘Ù Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø®ÙÙŠÙ’Ø±Ù Ù…ÙØ§ ÙÙÙŠ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù ÙˆÙØ®ÙÙŠÙ’Ø±Ù Ù…ÙØ§ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡ÙØŒ ÙˆÙØ£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù Ù…ÙØ§ ÙÙÙŠ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’ÙŠÙÙˆÙ’Ù…Ù ÙˆÙØ´ÙØ±Ù‘Ù Ù…ÙØ§ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡Ù.", count: 1 },
        { id: "m5_3", text: "Ø±ÙØ¨Ù‘Ù Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù Ø§Ù„Ù’ÙƒÙØ³ÙÙ„Ù ÙˆÙØ³ÙÙˆØ¡Ù Ø§Ù„Ù’ÙƒÙØ¨ÙØ±ÙØŒ Ø±ÙØ¨Ù‘Ù Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø¹ÙØ°ÙØ§Ø¨Ù ÙÙÙŠ Ø§Ù„Ù†Ù‘ÙØ§Ø±Ù ÙˆÙØ¹ÙØ°ÙØ§Ø¨Ù ÙÙÙŠ Ø§Ù„Ù’Ù‚ÙØ¨Ù’Ø±Ù.", count: 1 },
        { id: "m6", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø£ÙÙ†Ù’ØªÙ Ø±ÙØ¨Ù‘ÙÙŠ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø£ÙÙ†Ù’ØªÙØŒ Ø®ÙÙ„ÙÙ‚Ù’ØªÙÙ†ÙÙŠ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙØ¨Ù’Ø¯ÙÙƒÙØŒ ÙˆÙØ£ÙÙ†ÙØ§ Ø¹ÙÙ„ÙÙ‰ Ø¹ÙÙ‡Ù’Ø¯ÙÙƒÙ ÙˆÙÙˆÙØ¹Ù’Ø¯ÙÙƒÙ Ù…ÙØ§ Ø§Ø³Ù’ØªÙØ·ÙØ¹Ù’ØªÙØŒ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙ Ù…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù Ù…ÙØ§ ØµÙÙ†ÙØ¹Ù’ØªÙØŒ Ø£ÙØ¨ÙÙˆØ¡Ù Ù„ÙÙƒÙ Ø¨ÙÙ†ÙØ¹Ù’Ù…ÙØªÙÙƒÙ Ø¹ÙÙ„ÙÙŠÙ‘ÙØŒ ÙˆÙØ£ÙØ¨ÙÙˆØ¡Ù Ø¨ÙØ°ÙÙ†Ù’Ø¨ÙÙŠ ÙÙØ§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ ÙÙØ¥ÙÙ†Ù‘ÙÙ‡Ù Ù„ÙØ§ ÙŠÙØºÙ’ÙÙØ±Ù Ø§Ù„Ø°Ù‘ÙÙ†ÙÙˆØ¨Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø£Ù†ØªÙ.", count: 1 },
        { id: "m7", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø¥ÙÙ†Ù‘ÙÙŠ Ø£ÙØµÙ’Ø¨ÙØ­Ù’ØªÙ Ø£ÙØ´Ù’Ù‡ÙØ¯ÙÙƒÙ ÙˆÙØ£ÙØ´Ù’Ù‡ÙØ¯Ù Ø­ÙÙ…ÙÙ„ÙØ©Ù Ø¹ÙØ±Ù’Ø´ÙÙƒÙØŒ ÙˆÙÙ…ÙÙ„ÙØ§Ø¦ÙÙƒÙØªÙÙƒÙ ÙˆÙØ¬ÙÙ…ÙÙŠØ¹Ù Ø®ÙÙ„Ù’Ù‚ÙÙƒÙØŒ Ø£ÙÙ†Ù‘ÙÙƒÙ Ø£ÙÙ†Ù’ØªÙ Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø£ÙÙ†Ù’ØªÙ ÙˆÙØ­Ù’Ø¯ÙÙƒÙ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙØŒ ÙˆÙØ£ÙÙ†Ù‘Ù Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù‹Ø§ Ø¹ÙØ¨Ù’Ø¯ÙÙƒÙ ÙˆÙØ±ÙØ³ÙÙˆÙ„ÙÙƒÙ.", count: 4 },
        { id: "m8", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù…ÙØ§ Ø£ÙØµÙ’Ø¨ÙØ­Ù Ø¨ÙÙŠ Ù…ÙÙ†Ù’ Ù†ÙØ¹Ù’Ù…ÙØ©Ù Ø£ÙÙˆÙ’ Ø¨ÙØ£ÙØ­ÙØ¯Ù Ù…ÙÙ†Ù’ Ø®ÙÙ„Ù’Ù‚ÙÙƒÙ ÙÙÙ…ÙÙ†Ù’ÙƒÙ ÙˆÙØ­Ù’Ø¯ÙÙƒÙ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙØŒ ÙÙÙ„ÙÙƒÙ Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ„ÙÙƒÙ Ø§Ù„Ø´Ù‘ÙÙƒÙ’Ø±Ù.", count: 1 },
        { id: "m9", text: "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø§Ù„Ù‘ÙØ°ÙÙŠ Ù„ÙØ§ ÙŠÙØ¶ÙØ±Ù‘Ù Ù…ÙØ¹Ù Ø§Ø³Ù’Ù…ÙÙ‡Ù Ø´ÙÙŠÙ’Ø¡ÙŒ ÙÙÙŠ Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù ÙˆÙÙ„ÙØ§ ÙÙÙŠ Ø§Ù„Ø³Ù‘ÙÙ…ÙØ§Ø¡Ù ÙˆÙÙ‡ÙÙˆÙ Ø§Ù„Ø³Ù‘ÙÙ…ÙÙŠØ¹Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ…Ù.", count: 3 },
        { id: "m10", text: "Ø±ÙØ¶ÙÙŠØªÙ Ø¨ÙØ§Ù„Ù„Ù‘ÙÙ‡Ù Ø±ÙØ¨Ù‘Ù‹Ø§ØŒ ÙˆÙØ¨ÙØ§Ù„Ù’Ø¥ÙØ³Ù’Ù„ÙØ§Ù…Ù Ø¯ÙÙŠÙ†Ù‹Ø§ØŒ ÙˆÙØ¨ÙÙ…ÙØ­ÙÙ…Ù‘ÙØ¯Ù ØµÙÙ„Ù‘ÙÙ‰ Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡Ù ÙˆÙØ³ÙÙ„Ù‘ÙÙ…Ù Ù†ÙØ¨ÙÙŠÙ‘Ù‹Ø§.", count: 3 },
        { id: "m11", text: "ÙŠÙØ§ Ø­ÙÙŠÙ‘Ù ÙŠÙØ§ Ù‚ÙÙŠÙ‘ÙÙˆÙ…Ù Ø¨ÙØ±ÙØ­Ù’Ù…ÙØªÙÙƒÙ Ø£ÙØ³Ù’ØªÙØºÙÙŠØ«Ù Ø£ÙØµÙ’Ù„ÙØ­Ù’ Ù„ÙÙŠ Ø´Ø£Ù’Ù†ÙÙŠ ÙƒÙÙ„Ù‘ÙÙ‡Ù ÙˆÙÙ„ÙØ§ ØªÙÙƒÙÙ„Ù’Ù†ÙÙŠ Ø¥ÙÙ„ÙÙ‰ Ù†ÙÙÙ’Ø³ÙÙŠ Ø·ÙØ±Ù’ÙÙØ©Ù Ø¹ÙÙŠÙ’Ù†Ù.", count: 1 },
        { id: "m16", text: "Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù.", count: 100 },
        { id: "m17", text: "Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯ÙØŒ ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ.", count: 10 }
    ],
    evening: [
        { id: "e1", text: "Ø£Ø¹ÙˆØ° Ø¨Ø§Ù„Ù„Ù‡ Ù…Ù† Ø§Ù„Ø´ÙŠØ·Ø§Ù† Ø§Ù„Ø±Ø¬ÙŠÙ… (Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ)", count: 1 },
        { id: "e2", text: "Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ ÙˆÙØ£ÙÙ…Ù’Ø³ÙÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘ÙÙ‡ÙØŒ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ.", count: 1 },
        { id: "e3", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙØŒ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù’Ù…ÙØµÙÙŠØ±Ù.", count: 1 },
        { id: "e4", text: "Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙÙ„ÙÙ…ÙØ§ØªÙ Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø§Ù„ØªÙ‘ÙØ§Ù…Ù‘ÙØ§ØªÙ Ù…ÙÙ†Ù’ Ø´ÙØ±Ù‘Ù Ù…ÙØ§ Ø®ÙÙ„ÙÙ‚Ù.", count: 3 },
        { id: "e5", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù…ÙØ§ Ø£ÙÙ…Ù’Ø³ÙÙ‰ Ø¨ÙÙŠ Ù…ÙÙ†Ù’ Ù†ÙØ¹Ù’Ù…ÙØ©Ù Ø£ÙÙˆÙ’ Ø¨ÙØ£ÙØ­ÙØ¯Ù Ù…ÙÙ†Ù’ Ø®ÙÙ„Ù’Ù‚ÙÙƒÙ ÙÙÙ…ÙÙ†Ù’ÙƒÙ ÙˆÙØ­Ù’Ø¯ÙÙƒÙ Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙƒÙØŒ ÙÙÙ„ÙÙƒÙ Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ„ÙÙƒÙ Ø§Ù„Ø´Ù‘ÙÙƒÙ’Ø±Ù.", count: 1 },
        { id: "e6", text: "Ø­ÙØ³Ù’Ø¨ÙÙŠÙ Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù‡ÙÙˆÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡Ù ØªÙÙˆÙÙƒÙ‘ÙÙ„Ù’ØªÙ ÙˆÙÙ‡ÙÙˆÙ Ø±ÙØ¨Ù‘Ù Ø§Ù„Ù’Ø¹ÙØ±Ù’Ø´Ù Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù.", count: 7 }
    ],
    sleep: [
        { id: "s1", text: "Ø¨ÙØ§Ø³Ù’Ù…ÙÙƒÙ Ø±ÙØ¨Ù‘ÙÙŠ ÙˆÙØ¶ÙØ¹Ù’ØªÙ Ø¬ÙÙ†Ù’Ø¨ÙÙŠØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙØ±Ù’ÙÙØ¹ÙÙ‡ÙØŒ ÙÙØ¥ÙÙ†Ù’ Ø£ÙÙ…Ù’Ø³ÙÙƒÙ’ØªÙ Ù†ÙÙÙ’Ø³ÙÙŠ ÙÙØ§Ø±Ù’Ø­ÙÙ…Ù’Ù‡ÙØ§ØŒ ÙˆÙØ¥ÙÙ†Ù’ Ø£ÙØ±Ù’Ø³ÙÙ„Ù’ØªÙÙ‡ÙØ§ ÙÙØ§Ø­Ù’ÙÙØ¸Ù’Ù‡ÙØ§ Ø¨ÙÙ…ÙØ§ ØªÙØ­Ù’ÙÙØ¸Ù Ø¨ÙÙ‡Ù Ø¹ÙØ¨ÙØ§Ø¯ÙÙƒÙ Ø§Ù„ØµÙ‘ÙØ§Ù„ÙØ­ÙÙŠÙ†Ù.", count: 1 },
        { id: "s2", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø®ÙÙ„ÙÙ‚Ù’ØªÙ Ù†ÙÙÙ’Ø³ÙÙŠ ÙˆÙØ£ÙÙ†Ù’ØªÙ ØªÙÙˆÙÙÙ‘ÙØ§Ù‡ÙØ§ØŒ Ù„ÙÙƒÙ Ù…ÙÙ…ÙØ§ØªÙÙ‡ÙØ§ ÙˆÙÙ…ÙØ­Ù’ÙŠÙØ§Ù‡ÙØ§ØŒ Ø¥ÙÙ†Ù’ Ø£ÙØ­Ù’ÙŠÙÙŠÙ’ØªÙÙ‡ÙØ§ ÙÙØ§Ø­Ù’ÙÙØ¸Ù’Ù‡ÙØ§ØŒ ÙˆÙØ¥ÙÙ†Ù’ Ø£ÙÙ…ÙØªÙ‘ÙÙ‡ÙØ§ ÙÙØ§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙ‡ÙØ§.", count: 1 },
        { id: "s3", text: "Ø¨ÙØ§Ø³Ù’Ù…ÙÙƒÙ Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø£ÙÙ…ÙÙˆØªÙ ÙˆÙØ£ÙØ­Ù’ÙŠÙØ§.", count: 1 },
        { id: "s4_1", text: "Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù", count: 33 },
        { id: "s4_2", text: "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘ÙÙ‡Ù", count: 33 },
        { id: "s4_3", text: "Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù", count: 34 },
        { id: "s5", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ù‚ÙÙ†ÙÙŠ Ø¹ÙØ°ÙØ§Ø¨ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù ØªÙØ¨Ù’Ø¹ÙØ«Ù Ø¹ÙØ¨ÙØ§Ø¯ÙÙƒÙ.", count: 3 }
    ],
    afterPrayer: [
        { id: "p1", text: "Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù", count: 3 },
        { id: "p2", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø£ÙÙ†Ù’ØªÙ Ø§Ù„Ø³Ù‘ÙÙ„ÙØ§Ù…Ù ÙˆÙÙ…ÙÙ†Ù’ÙƒÙ Ø§Ù„Ø³Ù‘ÙÙ„ÙØ§Ù…ÙØŒ ØªÙØ¨ÙØ§Ø±ÙÙƒÙ’ØªÙ ÙŠÙØ§ Ø°ÙØ§ Ø§Ù„Ù’Ø¬ÙÙ„ÙØ§Ù„Ù ÙˆÙØ§Ù„Ù’Ø¥ÙÙƒÙ’Ø±ÙØ§Ù…Ù.", count: 1 },
        { id: "p3", text: "Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‘ÙÙ‡Ù", count: 33 },
        { id: "p4", text: "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘ÙÙ‡Ù", count: 33 },
        { id: "p5", text: "Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù", count: 33 },
        { id: "p6", text: "Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø§Ù„Ù„Ù‘ÙÙ‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ.", count: 1 },
        { id: "p7", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø£ÙØ¹ÙÙ†Ù‘ÙÙŠ Ø¹ÙÙ„ÙÙ‰ Ø°ÙÙƒÙ’Ø±ÙÙƒÙØŒ ÙˆÙØ´ÙÙƒÙ’Ø±ÙÙƒÙØŒ ÙˆÙØ­ÙØ³Ù’Ù†Ù Ø¹ÙØ¨ÙØ§Ø¯ÙØªÙÙƒÙ.", count: 1 }
    ],
    generalDuas: [
        { id: "d1", text: "Ø±ÙØ¨Ù‘ÙÙ†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯Ù‘ÙÙ†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙ‚ÙÙ†ÙØ§ Ø¹ÙØ°ÙØ§Ø¨Ù Ø§Ù„Ù†Ù‘ÙØ§Ø±Ù.", count: 1 },
        { id: "d2", text: "ÙŠÙØ§ Ù…ÙÙ‚ÙÙ„Ù‘ÙØ¨Ù Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù Ø«ÙØ¨Ù‘ÙØªÙ’ Ù‚ÙÙ„Ù’Ø¨ÙÙŠ Ø¹ÙÙ„ÙÙ‰ Ø¯ÙÙŠÙ†ÙÙƒÙ.", count: 1 },
        { id: "d3", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø¥ÙÙ†Ù‘ÙÙƒÙ Ø¹ÙÙÙÙˆÙ‘ÙŒ ØªÙØ­ÙØ¨Ù‘Ù Ø§Ù„Ù’Ø¹ÙÙÙ’ÙˆÙ ÙÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†Ù‘ÙÙŠ.", count: 1 },
        { id: "d4", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø¥ÙÙ†Ù‘ÙÙŠ Ø£ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ Ø§Ù„Ù’Ù‡ÙØ¯ÙÙ‰ ÙˆÙØ§Ù„ØªÙ‘ÙÙ‚ÙÙ‰ ÙˆÙØ§Ù„Ù’Ø¹ÙÙÙØ§ÙÙ ÙˆÙØ§Ù„Ù’ØºÙÙ†ÙÙ‰.", count: 1 },
        { id: "d5", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù Ø§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠØŒ ÙˆÙØ§Ø±Ù’Ø­ÙÙ…Ù’Ù†ÙÙŠØŒ ÙˆÙØ§Ù‡Ù’Ø¯ÙÙ†ÙÙŠØŒ ÙˆÙØ¹ÙØ§ÙÙÙ†ÙÙŠØŒ ÙˆÙØ§Ø±Ù’Ø²ÙÙ‚Ù’Ù†ÙÙŠ.", count: 1 },
        { id: "d6", text: "Ù„Ø§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ø£ÙÙ†Ù’ØªÙ Ø³ÙØ¨Ù’Ø­ÙØ§Ù†ÙÙƒÙ Ø¥ÙÙ†Ù‘ÙÙŠ ÙƒÙÙ†Ù’ØªÙ Ù…ÙÙ†Ù Ø§Ù„Ø¸Ù‘ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù.", count: 1 },
        { id: "d7", text: "Ø§Ù„Ù„Ù‘ÙÙ‡ÙÙ…Ù‘Ù ØµÙÙ„Ù‘Ù ÙˆÙØ³ÙÙ„Ù‘ÙÙ…Ù’ Ø¹ÙÙ„ÙÙ‰ Ù†ÙØ¨ÙÙŠÙ‘ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù.", count: 10 }
    ]
};

// --- 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø°ÙƒØ§Ø± ---
function loadAzkar(cat) {
    document.getElementById('azkarCats').style.display = 'none';
    document.getElementById('azkar-content').style.display = 'block';
    const list = document.getElementById('azkarList');
    
    const titles = { 
        morning: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­', evening: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡', 
        sleep: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…', afterPrayer: 'Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©',
        generalDuas: 'Ø£Ø¯Ø¹ÙŠØ© Ø¹Ø§Ù…Ø©' 
    };
    
    document.getElementById('azkar-title').innerText = titles[cat] || 'Ø§Ù„Ø£Ø°ÙƒØ§Ø±';

    list.innerHTML = azkarData[cat].map(z => {
        let saved = localStorage.getItem(`zekr_${z.id}`);
        let cur = saved !== null ? parseInt(saved) : z.count;
        return `
            <div class="zekr-card ${cur === 0 ? 'completed' : ''}" onclick="countZekr('${z.id}')">
                <div class="zekr-text">${z.text}</div>
                <div class="zekr-counter">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="num-${z.id}">${cur}</span></div>
            </div>`;
    }).join('');
}

function countZekr(id) {
    const el = document.getElementById(`num-${id}`);
    if (!el) return;
    let c = parseInt(el.innerText);
    if (c > 0) {
        c--; el.innerText = c;
        localStorage.setItem(`zekr_${id}`, c);
        if (c === 0) {
            el.closest('.zekr-card').classList.add('completed');
            playNotify(); 
        }
    }
}

function backToAzkarCats() { 
    document.getElementById('azkarCats').style.display = 'grid'; 
    document.getElementById('azkar-content').style.display = 'none'; 
}

function resetAzkarProgress() { 
    if (confirm("ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø°ÙƒØ§Ø±ØŸ")) { 
        Object.keys(localStorage).forEach(k => { if (k.startsWith('zekr_')) localStorage.removeItem(k); }); 
        location.reload(); 
    } 
}

// --- 5. Ø§Ù„Ø³Ø¨Ø­Ø© ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ---
let sCount = parseInt(localStorage.getItem('sebhaCount')) || 0;
let sGoal = parseInt(localStorage.getItem('sebhaGoal')) || 100;

function updateGoal() {
    sGoal = parseInt(document.getElementById('sebhaGoal').value);
    localStorage.setItem('sebhaGoal', sGoal);
    updateProgress();
}

function incrementSebha() {
    sCount++;
    document.getElementById('sebhaCounter').innerText = sCount;
    localStorage.setItem('sebhaCount', sCount);
    updateProgress();
    
    if (sCount === sGoal) {
        document.querySelector('.sebha-circle').classList.add('goal-reached');
        playNotify(); 
    }
}

function updateProgress() {
    let percent = Math.min((sCount / sGoal) * 100, 100);
    const bar = document.getElementById('sebhaBar');
    if(bar) bar.style.width = percent + "%";
}

function resetSebha() {
    if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ø³Ø¨Ø­Ø©ØŸ")) {
        sCount = 0;
        document.getElementById('sebhaCounter').innerText = 0;
        document.querySelector('.sebha-circle').classList.remove('goal-reached');
        localStorage.setItem('sebhaCount', 0);
        updateProgress();
    }
}

function updateCountdown() {
    const now = new Date();
    const tomorrow = new Date();
    tomorrow.setDate(now.getDate() + 1);
    tomorrow.setHours(0, 0, 0, 0);
    const diff = tomorrow - now;

    if (diff <= 0) { resetSebhaAutomated(); }

    const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const m = Math.floor((diff / (1000 * 60)) % 60);
    const s = Math.floor((diff / 1000) % 60);

    const timerDisplay = document.getElementById('countdown-timer');
    if(timerDisplay) {
        timerDisplay.innerText = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }
}

function resetSebhaAutomated() {
    sCount = 0;
    document.getElementById('sebhaCounter').innerText = 0;
    localStorage.setItem('sebhaCount', 0);
    updateProgress();
}

setInterval(updateCountdown, 1000);

// --- 6. Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„Ø®Ø· ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ ---
function switchMainTab(t) {
    document.querySelectorAll('.main-nav button').forEach(b => b.classList.remove('active'));
    document.getElementById(t + 'Tab').classList.add('active');
    ['quran-section', 'azkar-section', 'sebha-section'].forEach(s => { 
        document.getElementById(s).style.display = s.startsWith(t) ? 'block' : 'none'; 
    });
}

function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }
function changeFontSize(d) { 
    const el = document.getElementById('ayahsContainer'); 
    let s = window.getComputedStyle(el).fontSize; 
    el.style.fontSize = (parseFloat(s) + d) + 'px'; 
}

// --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ---
document.getElementById('sebhaCounter').innerText = sCount;
document.getElementById('sebhaGoal').value = sGoal;
document.getElementById('muteBtn').innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š";
updateProgress();
updateCountdown();
let prayerTimesData = null;

// 1. Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
function fetchPrayers() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            const url = `https://api.aladhan.com/v1/timings?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&method=4`;
            fetch(url).then(res => res.json()).then(data => {
                prayerTimesData = data.data.timings;
                updatePrayerUI();
                startPrayerCountdown();
            });
        });
    }
}

// 2. ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
function updatePrayerUI() {
    if(!prayerTimesData) return;
    document.getElementById('fajr-time').innerText = prayerTimesData.Fajr;
    document.getElementById('dhuhr-time').innerText = prayerTimesData.Dhuhr;
    document.getElementById('asr-time').innerText = prayerTimesData.Asr;
    document.getElementById('maghrib-time').innerText = prayerTimesData.Maghrib;
    document.getElementById('isha-time').innerText = prayerTimesData.Isha;
}

// 3. Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
function startPrayerCountdown() {
    setInterval(() => {
        if (!prayerTimesData) return;
        const now = new Date();
        const prayers = [
            {n: "Ø§Ù„ÙØ¬Ø±", t: prayerTimesData.Fajr},
            {n: "Ø§Ù„Ø¸Ù‡Ø±", t: prayerTimesData.Dhuhr},
            {n: "Ø§Ù„Ø¹ØµØ±", t: prayerTimesData.Asr},
            {n: "Ø§Ù„Ù…ØºØ±Ø¨", t: prayerTimesData.Maghrib},
            {n: "Ø§Ù„Ø¹Ø´Ø§Ø¡", t: prayerTimesData.Isha}
        ];

        let next = null;
        for (let p of prayers) {
            const [h, m] = p.t.split(':');
            const d = new Date(); d.setHours(h, m, 0);
            if (d > now) { next = {n: p.n, d: d}; break; }
        }

        if (!next) { // Ù„Ùˆ Ø§Ù†ØªÙ‡Øª ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ØŒ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙØ¬Ø± Ø§Ù„ØºØ¯
            const [h, m] = prayers[0].t.split(':');
            const d = new Date(); d.setDate(d.getDate() + 1); d.setHours(h, m, 0);
            next = {n: "Ø§Ù„ÙØ¬Ø±", d: d};
        }

        const diff = next.d - now;
        const hh = Math.floor(diff / 3600000).toString().padStart(2, '0');
        const mm = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
        const ss = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');

        document.getElementById('next-prayer-name').innerText = `Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${next.n}`;
        document.getElementById('next-prayer-timer').innerText = `${hh}:${mm}:${ss}`;
    }, 1000);
}
// --- 7. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù‚Ø¨Ù„Ø© (Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰) ---

// --- 7. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù‚Ø¨Ù„Ø© (Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­ÙŠØ©) ---
let finalQiblaAngle = 0;

function getQibla() {
    if (navigator.geolocation) {
        document.getElementById('qibla-status').innerText = "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...";

        navigator.geolocation.getCurrentPosition(position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            
            // Ø­Ø³Ø§Ø¨ Ø²Ø§ÙˆÙŠØ© Ù…ÙƒØ©
            const phiK = 21.4225 * Math.PI / 180;
            const lambdaK = 39.8262 * Math.PI / 180;
            const phi = lat * Math.PI / 180;
            const lambda = lng * Math.PI / 180;
            let qDeg = Math.atan2(Math.sin(lambdaK - lambda), Math.cos(phi) * Math.tan(phiK) - Math.sin(phi) * Math.cos(lambdaK - lambda));
            finalQiblaAngle = (qDeg * 180 / Math.PI + 360) % 360;
            
            document.getElementById('qibla-deg').innerText = Math.round(finalQiblaAngle);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ø·Ù„Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø³
            document.getElementById('qibla-status').innerHTML = `
                <button onclick="askCompassPermission()" style="background:var(--gold); color:var(--dark-teal); border:none; padding:8px 15px; border-radius:10px; font-weight:bold; cursor:pointer; font-family:inherit;">
                    ØªÙØ¹ÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ø¨ÙˆØµÙ„Ø© ğŸ§­
                </button>`;
        }, (err) => {
            document.getElementById('qibla-status').innerText = "ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹";
        }, { enableHighAccuracy: false, timeout: 5000 });
    }
}

// Ø¯Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„Ø­Ø³Ø§Ø³Ø§Øª (Ø¶Ø±ÙˆØ±ÙŠØ© Ù„Ù€ iOS)
function askCompassPermission() {
    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
            .then(state => {
                if (state === 'granted') {
                    window.addEventListener('deviceorientation', handleCompass, true);
                }
            }).catch(e => console.error(e));
    } else {
        window.addEventListener('deviceorientationabsolute', handleCompass, true);
        window.addEventListener('deviceorientation', handleCompass, true);
    }
}

function handleCompass(e) {
    let compass = e.webkitCompassHeading || (360 - e.alpha);
    if (compass === undefined) return;

    const rotateDeg = finalQiblaAngle - compass;
    const pointer = document.getElementById('compass-pointer');
    const statusText = document.getElementById('qibla-status');

    if (pointer) {
        pointer.style.transform = `translate(-50%, -100%) rotate(${rotateDeg}deg)`;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµØ­ÙŠØ­ (ÙØ±Ù‚ 5 Ø¯Ø±Ø¬Ø§Øª)
        const isCorrect = Math.abs(rotateDeg % 360) < 5 || Math.abs(rotateDeg % 360) > 355;
        
        if (isCorrect) {
            pointer.style.backgroundColor = "#27ae60"; 
            pointer.style.boxShadow = "0 0 15px #27ae60";
            statusText.innerHTML = "<span style='color:#27ae60; font-weight:bold;'>Ø£Ù†Øª Ø¨Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø© Ø§Ù„Ø¢Ù† âœ…</span>";
        } else {
            pointer.style.backgroundColor = "var(--gold)";
            pointer.style.boxShadow = "none";
            statusText.innerHTML = "<span style='color:var(--gold);'>Ø¯ÙˆÙ‘Ø± Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ø¶Ø¨Ø· Ø§Ù„Ø§ØªØ¬Ø§Ù‡</span>";
        }
    }
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„Ø© (ØªØ£ÙƒØ¯ Ø£Ù†Ù‡Ø§ Ø§Ù„ÙˆØ­ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù)
function switchMainTab(t) {
    document.querySelectorAll('.main-nav button').forEach(b => b.classList.remove('active'));
    document.getElementById(t + 'Tab')?.classList.add('active');

    const allSections = ['quran-section', 'azkar-section', 'sebha-section', 'prayer-section', 'qibla-section'];
    allSections.forEach(s => {
        const el = document.getElementById(s);
        if (el) el.style.display = s.startsWith(t) ? 'block' : 'none';
    });
    
    if(t === 'qibla') getQibla();
    if(t === 'prayer') fetchPrayers();
}